class t{static gameStatuses={idle:"idle",playing:"playing",lose:"lose",win:"win"};constructor(e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=e,this.state=this.initialState.map(t=>[...t]),this.status=t.gameStatuses.idle,this.score=0}moveLeft(){if(this.getStatus()!==t.gameStatuses.playing)return;let e=this.state.map(t=>this.move(t));JSON.stringify(this.getState())!==JSON.stringify(e)&&(this.updateGameState(e),this.addCells())}moveRight(){if(this.getStatus()!==t.gameStatuses.playing)return;let e=this.state.map(t=>[...t].reverse()).map(t=>this.move(t).reverse());JSON.stringify(this.getState())!==JSON.stringify(e)&&(this.updateGameState(e),this.addCells())}moveUp(){if(this.getStatus()!==t.gameStatuses.playing)return;let e=this.rotateMatrixCounteClockwise(this.getState()).map(t=>this.move(t)),s=this.rotateMatrixClockwise(e);JSON.stringify(this.getState())!==JSON.stringify(s)&&(this.updateGameState(s),this.addCells())}moveDown(){if(this.getStatus()!==t.gameStatuses.playing)return;let e=this.rotateMatrixClockwise(this.getState()).map(t=>this.move(t)),s=this.rotateMatrixCounteClockwise(e);JSON.stringify(this.getState())!==JSON.stringify(s)&&(this.updateGameState(s),this.addCells())}move(t){let e=[],s=0;for(;s<t.length;){let a=t[s];if(a){let i=!1;for(let r=s+1;r<t.length;r++){let l=t[r];if(l===a){e.push(2*a),this.updateGameScore(2*a),i=!0,s=r+1;break}if(l){e.push(a),i=!0,s=r;break}}!i&&(e.push(a),s++)}else s++}for(;e.length<t.length;)e.push(0);return e}rotateMatrixClockwise(t){let e=t.length,s=[];for(let a=0;a<e;a++){s.push([]);for(let i=0;i<e;i++)s[a].unshift(t[i][a])}return s}rotateMatrixCounteClockwise(t){let e=t.length,s=[];for(let a=0;a<e;a++){s.unshift([]);for(let i=0;i<e;i++)s[0].push(t[i][a])}return s}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status=t.gameStatuses.playing,this.addCells(2)}restart(){this.status=t.gameStatuses.idle,this.resetState()}getEmptyCells(){return this.state.flatMap((t,e)=>t.map((t,s)=>0===t?[e,s]:null)).filter(t=>null!==t)}createNewTile(){let t=this.getEmptyCells();if(!t.length)return;let[e,s]=t[Math.trunc(Math.random()*t.length)];this.state[e][s]=.9>Math.random()?2:4}addCells(e=1){for(let t=0;t<e;t++)this.createNewTile();let s=this.getState();this.isVictory(s)?this.status=t.gameStatuses.win:this.isGameOver(s)&&(this.status=t.gameStatuses.lose)}resetState(){this.state=this.initialState.map(t=>[...t]),this.score=0}isGameOver(e){if(this.status!==t.gameStatuses.playing)return!1;for(let t=0;t<e.length;t++)for(let s=0;s<e[t].length;s++)if(0===e[t][s]||s<e[t].length-1&&e[t][s]===e[t][s+1]||t<e.length-1&&e[t][s]===e[t+1][s])return!1;return!0}updateGameState(t){this.state=t}updateGameScore(t){this.score+=t}isVictory(t){return t.flat().some(t=>2048===t)}}const e=new t,s=document.querySelector(".container"),a=document.querySelector(".game-field"),i=s.querySelector(".button"),r=s.querySelector(".game-score"),l=[...a.querySelectorAll(".field-row")].map(t=>[...t.children]),n={idle:s.querySelector(".message-start"),lose:s.querySelector(".message-lose"),win:s.querySelector(".message-win")};function o(t){t.forEach((t,e)=>{t.forEach((t,s)=>{let a=l[e][s];a.className=t?`field-cell field-cell--${t}`:"field-cell",a.innerHTML=t||""})})}function h(){let t=e.getStatus();for(let e in n)if(Object.hasOwnProperty.call(n,e)){let s=n[e];s&&s.classList.toggle("hidden",e!==t)}}function u(t){r.innerHTML=t}i.addEventListener("click",()=>{"Start"===i.textContent?(e.start(),i.textContent="Restart",i.classList.replace("start","restart")):(e.restart(),u(0),i.textContent="Start",i.classList.replace("restart","start")),o(e.getState()),h()}),document.addEventListener("keydown",t=>{if(t.preventDefault(),"playing"!==e.getStatus())return;let s={ArrowUp:e.moveUp,ArrowDown:e.moveDown,ArrowLeft:e.moveLeft,ArrowRight:e.moveRight}[t.key];s&&s.call(e),o(e.getState()),u(e.getScore()),h()});
//# sourceMappingURL=index.1cfe3e33.js.map
